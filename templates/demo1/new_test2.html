<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>Tables - Atlantis Lite Bootstrap 4 Admin Dashboard</title>
	<meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
	<link rel="icon" href="../../assets/img/icon.ico" type="image/x-icon"/>
	
	<!-- Fonts and icons -->
	<script src="../../assets/js/plugin/webfont/webfont.min.js"></script>
	<script>
		WebFont.load({
			google: {"families":["Lato:300,400,700,900"]},
			custom: {"families":["Flaticon", "Font Awesome 5 Solid", "Font Awesome 5 Regular", "Font Awesome 5 Brands", "simple-line-icons"], urls: ['../../assets/css/fonts.min.css']},
			active: function() {
				sessionStorage.fonts = true;
			}
		});
	</script>

	<!-- CSS Files -->
    <link rel="stylesheet" href="../../assets/css/custom.css">
	<link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="../../assets/css/atlantis.min.css">
	<!-- CSS Just for demo purpose, don't include it in your project -->
	<link rel="stylesheet" href="../../assets/css/demo.css">
    <style>
    .nav-pills .nav-link.active, .nav-pills .show>.nav-link {
        color: #fff;
        background-color: #dc3545;
    }
    .nav-pills>li>.nav-link {
        margin-left: -1px;
        border-radius: 0!important;
        margin-top: 5px;
        margin-bottom: 5px;
        border: 1px solid #dc3545;
        color: #dc3545;
    }
    .nav-pills>li>.nav-link.active {
        background: #dc3545;
    }

    .sidebar.sidebar-style-2 .nav .nav-item a:focus, .sidebar.sidebar-style-2 .nav .nav-item a:hover, .sidebar.sidebar-style-2 .nav .nav-item a[data-toggle=collapse][aria-expanded=true] {
    background: #dc3545;
    }
    .sidebar.sidebar-style-2 .nav .nav-item a:focus i, .sidebar.sidebar-style-2 .nav .nav-item a:focus p, .sidebar.sidebar-style-2 .nav .nav-item a:hover i, .sidebar.sidebar-style-2 .nav .nav-item a:hover p, .sidebar.sidebar-style-2 .nav .nav-item a[data-toggle=collapse][aria-expanded=true] i, .sidebar.sidebar-style-2 .nav .nav-item a[data-toggle=collapse][aria-expanded=true] p {
        color: #f7f7f7 !important;
    }
    .page-item.active .page-link {
        z-index: 1;
        color: #fff;
        background-color: #dc3545;
        border-color: #f7f7f7;
    }
	li>.nav-item.submenu.active{
		background: #dc3545;
	}
	td>.undefined.success{
		background-color: green;
	}
	td>.undefined.failure{
		background-color: indianred;
	}
	td>.undefined{
		background-color: indigo;
	}
	table tr th td{
		border: 1px solid white;
		z-index: 1;
		border-color: white;
	margin-bottom:1em;

	}
	table {
    border-collapse: separate;
	border-spacing: 0 1em;
	}
	td {
    padding-top: .5em;
    padding-bottom: .5em;
}
.collapsed.group.group-start{
	margin-bottom:1em;
	border-collapse: separate;
	border-spacing: 0 1em;
}
.center {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 50%;
}
.loader {
  border: 16px solid #f3f3f3; /* Light grey */
  border-top: 16px solid #db3434; /* Blue */
  border-radius: 50%;
  width: 120px;
  height: 120px;
  animation: spin 2s linear infinite;
  margin-top: 200px;
  margin-left: auto;
  margin-right: auto;
}
/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}


    </style>
</head>
<body>
	<div class="loader" style="display: none;">
		
	</div>
	<div class="wrapper">
		<div class="main-header">
			<!-- Logo Header -->
			<div class="logo-header" data-background-color="white">
				
				<a href="../index.html" class="logo">
                    <img src="../assets/img/airtel.svg" style="height:40px; width:160px;" alt="navbar brand" class="navbar-brand">
				</a>
				<button class="navbar-toggler sidenav-toggler ml-auto" type="button" data-toggle="collapse" data-target="collapse" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon">
						<i class="icon-menu"></i>
					</span>
				</button>
				<button class="topbar-toggler more"><i class="fas fa-bars"></i></button>
				<div class="nav-toggle">
					<button class="btn btn-toggle toggle-sidebar">
						<i class="icon-menu"></i>
					</button>
				</div>
			</div>
			<!-- End Logo Header -->

			<!-- Navbar Header -->
			<nav class="navbar navbar-header navbar-expand-lg" data-background-color="white">
				
				<div class="container-fluid">   
					<ul class="nav nav-pills" id="pills-tab" role="tablist">
						<li class="nav-item">
							<a class="nav-link active" data-toggle="tab" aria-selected="true" href="#home">Status</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" data-toggle="tab" href="#menu1">Config</a>
						</li>
					</ul>     
					<ul class="navbar-nav topbar-nav ml-md-auto align-items-center">
                        <li class="nav-item" style="display:none;text-align: left; margin-right: 422px; color: white; font-size: initial; font-family: sans-serif;font-weight: 700;">
							<input id="myInput" type="text" placeholder="Search..">
						</li>
						
						<li class="nav-item dropdown hidden-caret">
							<a class="dropdown-toggle profile-pic" data-toggle="dropdown" href="#" aria-expanded="false">
								<div class="avatar-sm">
									<img src="../../assets/img/profile.jpg" alt="..." class="avatar-img rounded-circle">
								</div>
							</a>
							<ul class="dropdown-menu dropdown-user animated fadeIn">
								<div class="dropdown-user-scroll scrollbar-outer">
									<li>
										<div class="user-box">
											<div class="avatar-lg"><img src="../../assets/img/profile.jpg" alt="image profile" class="avatar-img rounded"></div>
											<div class="u-text">
												<h4>Hizrian</h4>
												<p class="text-muted">hello@example.com</p><a href="profile.html" class="btn btn-xs btn-danger btn-sm">View Profile</a>
											</div>
										</div>
									</li>
									<li>
										<div class="dropdown-divider"></div>
										<a class="dropdown-item" href="#">Logout</a>
									</li>
								</div>
							</ul>
						</li>
					</ul>
				</div>
			</nav>
			<!-- End Navbar -->
		</div>
		<!-- Sidebar -->
		<div class="sidebar sidebar-style-2">
			
			<div class="sidebar-wrapper scrollbar scrollbar-inner">
				<div class="sidebar-content">
					<ul class="nav nav-danger">
						<li class="nav-item" id="aa" onclick="addCol(this.id)">
							<a data-toggle="collapse" href="#dashboard" class="collapsed" aria-expanded="false">
								<i class="fas fa-home"></i>
								<p>Dashboard</p>
							</a>
						</li>
						<li class="nav-section">
							<span class="sidebar-mini-icon">
								<i class="fa fa-ellipsis-h"></i>
							</span>
							<h4 class="text-section">Components</h4>
						</li>
						<li class="nav-item" id="bb"  onclick="addCol(this.id)">
							<a data-toggle="collapse">
								<img src="./FlatIcons/dth.png" alt="img" style = "height: 25px; width: 25px;">
								<p style="padding: 0 7px;">DTH</p>
							</a>
						</li>
						<li class="nav-item active" id="cc" onclick="addCol(this.id)">
							<a data-toggle="collapse">
								<img src="./FlatIcons/mobility.png" alt="img" style = "height: 25px; width: 25px;">
								<p style="padding: 0 7px;">Mobility</p>
							</a>
						</li>
						<li class="nav-item" id="dd" class="chamatkar" onclick="addCol(this.id)">
							<a data-toggle="collapse">
								<img src="./FlatIcons/telemedia.png" alt="img" style = "height: 25px; width: 25px;">
								<p style="padding: 0 7px;">Telemedia</p>
							</a>
						</li>
						<li class="nav-item" id="ee" onclick="addCol(this.id)">
							<a data-toggle="collapse">
								<img src="./FlatIcons/b2b.png" alt="img" style = "height: 25px; width: 25px;">
								<p style="padding: 0 7px;">OOO_LOB</p>
							</a>
						</li>
                        <li class="nav-item" id="ff" onclick="addCol(this.id)">
							<a data-toggle="collapse">
								<!-- <i class="fas fa-layer-group"></i> -->
								<img src="./FlatIcons/overallStatus.png" alt="img" style = "height: 25px; width: 25px;">
								<p style="padding: 0 7px;">Overall Status</p>
							</a>
						</li>
						<li class="nav-item" id="chamatkar">
							<a>
								<p>Test</p>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<a class="forCheck" onclick="testCol()"></a>
		
		<div class="main-panel">
			
			<div class="card border-danger2">
				<div class="card-header bg-danger2 text-white card-title">Basic</div>
				<div class="card-body">
					<div class="table-responsive">
						<table id="example" class="display table table-striped table-bordered table-hover" cellspacing="0" width="100%">
							<thead class="sample_header" style="display: none;">
								<tr style="background-color:  rgb(255, 0, 0); color: white;">
									  <th>Remark</th>
									  <th>run_id</th>
									  <th>batch_id</th>
									  <th>lob_nm</th>
									  <th>app_nm</th>
									  <th>changeset_seq</th>
									  <th>fed_status</th>
									  <th>read_status</th>
									  <th>Action</th> 
								</tr>
							</thead>
							<tfoot>
								<tr>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
								</tr>
							</tfoot>
							</tbody>
						</table>
					</div>
					<div class="pagination" id="pagination"></div>
				</div>
			</div>
		</div>
		
	</div>
	<!--   Core JS Files   -->
	<script src="../../assets/js/core/jquery.3.2.1.min.js"></script>
	<script src="../../assets/js/core/popper.min.js"></script>
	<script src="../../assets/js/core/bootstrap.min.js"></script>
	<!-- jQuery UI -->
	<script src="../../assets/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
	<script src="../../assets/js/plugin/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"></script>
	
	<!-- jQuery Scrollbar -->
	<script src="../../assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
	<!-- Datatables -->

    <link href="../assets/css/jquery.dataTables.css" rel="stylesheet" type="text/css" />
	<!-- <script src="https://nightly.datatables.net/js/jquery.dataTables.js"></script> -->
	
	<script src="../../assets/js/plugin/datatables/datatables.min.js"></script>

	<!-- newdataaddedd -->
    <link href="../assets/css/rowGroup.dataTables.min.css" rel="stylesheet" type="text/css" />
    <script src="../assets/js/dataTables.rowGroup.min.js"></script>
    <!-- <script src="https://cdn.datatables.net/buttons/1.2.2/js/buttons.html5.js"></script> -->
    
	
	<!-- Atlantis JS -->
	<script src="../../assets/js/atlantis.min.js"></script>
	<!-- Atlantis DEMO methods, don't include it in your project! -->
	<script src="../../assets/js/setting-demo2.js"></script>
	<script src="../assets/js/crypto.js"></script>
	<!-- <link href="https://cdn.datatables.net/1.10.10/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/buttons/1.1.1/css/buttons.dataTables.min.css"  rel="stylesheet"/> -->


<!-- <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script> -->
	<!-- <script src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/1.1.1/js/dataTables.buttons.min.js"></script> 
	<script src="https://cdn.datatables.net/buttons/1.1.1/js/buttons.print.min.js"></script>  
<script src="https://cdn.datatables.net/buttons/1.1.1/js/buttons.colVis.min.js"></script> -->
	<script >
		$(document).ready(function() {
			
			
			$('#multi-filter-select').DataTable( {
				"pageLength": 5,
				initComplete: function () {
					this.api().columns().every( function () {
						var column = this;
						var select = $('<select class="form-control"><option value=""></option></select>')
						.appendTo( $(column.footer()).empty() )
						.on( 'change', function () {
							var val = $.fn.dataTable.util.escapeRegex(
								$(this).val()
								);

							column
							.search( val ? '^'+val+'$' : '', true, false )
							.draw();
						} );

						column.data().unique().sort().each( function ( d, j ) {
							select.append( '<option value="'+d+'">'+d+'</option>' )
						} );
					} );
				}
			});

			// Add Row
			$('#add-row').DataTable({
				"pageLength": 5,
			});

			var action = '<td> <div class="form-button-action"> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-danger btn-lg" data-original-title="Edit Task"> <i class="fa fa-edit"></i> </button> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-danger" data-original-title="Remove"> <i class="fa fa-times"></i> </button> </div> </td>';

			$('#addRowButton').click(function() {
				$('#add-row').dataTable().fnAddData([
					$("#addName").val(),
					$("#addPosition").val(),
					$("#addOffice").val(),
					action
					]);
				$('#addRowModal').modal('hide');

			});
		});
	</script>
	<script>
		$(document).ready(function() {
			var collapsedGroups = {};    
			var table = $('#example').DataTable({
				
				'ajax': 'http://localhost/NewTable/data2.php',
				"processing":true,
				"serverSide":true,
				"autowidth":true,
				"bInfo":false,
				"bPaginate":false,
				"bFilter":true,  
				'ajax':{
					"url":'http://localhost/NewTable/data2.php' ,
					"dataSrc":""
				},
				"columns":[
					{"data":"CHANGESET_REMARK"},
					{"data":"RUN_ID"},
					{"data":"BATCH_ID"},
					{"data":"LOB_NM"},
					{"data":"APP_NM"},
					{"data":"CHANGESET_SEQ"},
					{"data":"FED_STATUS"},
					{"data":null}
				],
				dom: 'Bfrtip',
				buttons: [
				{
					extend: 'print',
					exportOptions: {
					columns: ':visible'
					},
					customize: function(win) {
					$(win.document.body).find( 'table' ).find('td:last-child, th:last-child').remove();
					}
				}
				],
				"columnDefs": [{
                targets: [-2], render: function (a, b, data, d,ui) {
					const daa = data.FED_STATUS;
					var daa2 = data.LOB_NM;
					
                    
                    return  daa + " " + daa2;
					}
				}
		],
             
				orderFixed: [[2, 'desc']],
				rowGroup: {
				// Uses the 'row group' plugin
				dataSrc: 'CHANGESET_REMARK',
				startRender: function (rows, group,data) {
					var collapsed = !collapsedGroups[group];
					rows.nodes().each(function (r) {
						r.style.display = collapsed ? 'none' : '';
					});   
					
					var encrypted = CryptoJS.MD5(group).toString();
					var color = remainColor(encrypted);
					var status = remainStatus(encrypted);
					return $('<tr/>')
						.append('<td colspan="9" id='+ encrypted +' style="background-color:grey" onclick="remainColor(this.id)" class="undefined">' + group + ' (' + rows.count() + ')<span id='+ encrypted +' style="color:'+ color +';float:right"> '+ status +'</span></td>')
						.attr('data-name', group)
						.attr('id', encrypted+"data")
						.toggleClass('collapsed', collapsed);
				}
				}
			});
			
		
			$('#example tbody').on('click', 'tr.group-start', function () {	
				var colId = $(this).attr("id");
				openChild($(this), collapsedGroups, table, colId);
			});
		});
			var openGroup = [];
			function openChild(thisObj, collapsedGroups, table, colId){
				var dfd = new $.Deferred();
				var name = $(thisObj).data('name');
				if($(thisObj).attr("class") == "collapsed group group-start"){
					if(!openGroup.includes(colId)){
						openGroup.push(colId);
						console.log(openGroup);
						setTimeout(function(){
							for(l=0;l<=openGroup.length;l++){
								if(!$("#example").find('tbody #'+openGroup[l]).next().hasClass('.sample_header')){
									$("#example").find('tbody #'+openGroup[l]).after($('#example > thead').html());
								}
								
							}
						},100);
					}
					
				}else{
					Array.prototype.remove_by_value = function(val) {
					for (var i = 0; i < this.length; i++) {
						if (this[i] === val) {
						this.splice(i, 1);
						i--;
						}
					}
					return this;
					}
					openGroup.remove_by_value(colId)
					setTimeout(function(){
						console.log(openGroup);
							for(l=0;l<=openGroup.length;l++){
								if(!$("#example").find('tbody #'+openGroup[l]).next().hasClass('.sample_header')){
									$("#example").find('tbody #'+openGroup[l]).after($('#example > thead').html());
								}
							}
						},100);
					
				}
				collapsedGroups[name] = !collapsedGroups[name];
				data = table.draw(false);
				
				return dfd.promise();
			}
		function addCol(id){
			removeCol();
			$("#"+id).addClass("active");
		}
		function removeCol(){
			$(".nav-item.active.submenu").removeClass("active");
			$(".nav-item.active").removeClass("active");
		}
		$("#ff").click(function(){
			$("#close").css('display', "none");
		})
		
		function getApi(){
			var testArray = [];
			var successArray = [];
			var failedArray = [];
			var refederatedArray = [];
			var createdArray = [];
			var startedArray = [];
			var onholdArray = [];
			$.ajax({
			url: "http://localhost/NewTable/data2.php",
			type: 'GET',
			dataType: 'json', // added data type
			success: function(res) {
				j = 0;
				for(i=0;i<res.length;i++){
					data = res[i].CHANGESET_REMARK;
					var data = CryptoJS.MD5(data).toString();
					if (testArray.includes(data)){
						if (res[i].FED_STATUS == "SUCCESS"){
							if (successArray.includes(data)){

							}else{
								successArray.push(data);
							}
						}else if(res[i].FED_STATUS == "FAILED"){
							if (failedArray.includes(data)){

							}else{
								failedArray.push(data);
							}
						}else if(res[i].FED_STATUS == "RE-FEDERATED"){
							if (refederatedArray.includes(data)){

							}else{
								refederatedArray.push(data);
							}
						}else if(res[i].FED_STATUS == "CREATED"){
							if (createdArray.includes(data)){

							}else{
								createdArray.push(data);
							}
						}else if(res[i].FED_STATUS == "STARTED"){
							if (startedArray.includes(data)){

							}else{
								startedArray.push(data);
							}
						}else if(res[i].FED_STATUS == "On-Hold"){
							if (onholdArray.includes(data)){

							}else{
								onholdArray.push(data);
							}
						}else{
							
						}
					}else{
						
						testArray.push(data);
						if (res[i].FED_STATUS == "SUCCESS"){
							successArray.push(data)
						}else if(res[i].FED_STATUS == "FAILED"){
							failedArray.push(data);
						}else if(res[i].FED_STATUS == "RE-FEDERATED"){
							refederatedArray.push(data);
						}else if(res[i].FED_STATUS == "CREATED"){
							createdArray.push(data);
						}else if(res[i].FED_STATUS == "STARTED"){
							startedArray.push(data);
						}else if(res[i].FED_STATUS == "On-Hold"){
							onholdArray.push(data);
						}else{

						}
					}
				}
				for(j=0;j<testArray.length;j++){
					data = testArray[j]
					if(failedArray.includes(data)){
						$("span#"+data).css("color","red");
						storeColor(data, "red");
						storeStatus(data, "FAILED");
					}else if(onholdArray.includes(data)){
						$("span#"+data).css("color","orange");
						storeColor(data, "orange");
						storeStatus(data, "PARTIALLY SUCCESS");
					}	
					else if (createdArray.includes(data) && startedArray.includes(data) && refederatedArray.includes(data)){
						$("span#"+data).css("color","blue");
						storeColor(data, "blue");
						storeStatus(data, "IN-PROGRESS");
					}else if(successArray.includes(data) && refederatedArray.includes(data)){
						$("span#"+data).css("color","green");
						storeColor(data, "green");
						storeStatus(data, "SUCCESS");
					}
					else if(successArray.includes(data)){
						$("span#"+data).css("color","green");
						storeColor(data, "green");
						storeStatus(data, "SUCCESS");
					}else if(createdArray.includes(data) || refederatedArray.includes(data) || startedArray.includes(data)){
						$("span#"+data).css("color","blue");
						storeColor(data, "blue");
						storeStatus(data, "IN-PROGRESS");
					}else{
						$("span#"+data).css("color","orange");
						storeColor(data, "orange");
			   			storeStatus(data, "PARTIALLY SUCCESS");
					}
				}

				
			}
		});

		}
		$(document).ready(function(){
			getApi();
		})
		function storeColor(id, color){
			localStorage.setItem(id, color)
		}
		function storeStatus(id, status){
            sessionStorage.setItem(id, status);
        }
		function remainColor(id){
			color = localStorage.getItem(id);
			if (color==undefined){
				return "none";
			}else{
				return color;
			}
		}
		function remainStatus(id){
            status = sessionStorage.getItem(id)
            if (status == undefined){
                return undefined;
            }else{
                return status;
            }
           
		}
		
		$("#chamatkar").click(function(){
			$("#example").find('tbody .group.group-start').after($('#example > thead').html());
		})
		

	</script>
</body>
</html>